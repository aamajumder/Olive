{
  "input_model": {
    "type": "PyTorchModel",
    "config": {
      "model_path": "tiiuae/falcon-7b",
      "model_loader": "load_pytorch_origin_model",
      "model_script": "user_script.py",
      "io_config": {
        "input_names": [ "input_ids" ],
        "output_names": [ "output" ],
        "dynamic_axes": {
          "input_ids": {
            "0": "batch",
            "1": "sequence"
          }
        }
      },
      "dummy_inputs_func": "dummy_inputs"
    }
  },
  "systems": {
    "local_system": {
      "type": "LocalSystem",
      "config": {
        "accelerators": [ "gpu" ]
      }
    }
  },
  "evaluators": {
    "common_evaluator": {
      "metrics": [
        {
          "name": "latency",
          "type": "latency",
          "sub_types": [
            {
              "name": "avg",
              "priority": 1
            },
            { "name": "max" },
            { "name": "min" }
          ],
          "user_config": {
            "user_script": "user_script.py",
            "dataloader_func": "create_dataloader",
            "batch_size": 1
          }
        }
      ]
    }
  },
  "passes": {
    "torch_to_onnx": {
      "type": "OnnxConversion",
      "config": {
        "target_opset": 14,
        "save_as_external_data": true,
        "all_tensors_to_one_file": true
      }
    },
    "optimize": {
      "type": "OrtTransformersOptimization",
      "disable_search": true,
      "config": {
        "model_type": "gpt2",
        "opt_level": 0,
        "num_heads": 32,
        "hidden_size": 4096,
        "float16": true,
        "use_gpu": true,
        "keep_io_types": false,
        "force_fp32_nodes": [
          "/h.0/input_layernorm/ReduceMean",
          "/h.0/input_layernorm/Sub",
          "/h.0/input_layernorm/ReduceMean_1",
          "/h.0/input_layernorm/Pow",
          "/h.0/input_layernorm/Add",
          "/h.0/input_layernorm/Sqrt",
          "/h.0/input_layernorm/Add_1",
          "/h.1/input_layernorm/ReduceMean",
          "/h.1/input_layernorm/Sub",
          "/h.1/input_layernorm/ReduceMean_1",
          "/h.1/input_layernorm/Pow",
          "/h.1/input_layernorm/Add",
          "/h.1/input_layernorm/Sqrt",
          "/h.1/input_layernorm/Add_1",
          "/h.2/input_layernorm/ReduceMean",
          "/h.2/input_layernorm/Sub",
          "/h.2/input_layernorm/ReduceMean_1",
          "/h.2/input_layernorm/Pow",
          "/h.2/input_layernorm/Add",
          "/h.2/input_layernorm/Sqrt",
          "/h.2/input_layernorm/Add_1",
          "/h.3/input_layernorm/ReduceMean",
          "/h.3/input_layernorm/Sub",
          "/h.3/input_layernorm/ReduceMean_1",
          "/h.3/input_layernorm/Pow",
          "/h.3/input_layernorm/Add",
          "/h.3/input_layernorm/Sqrt",
          "/h.3/input_layernorm/Add_1",
          "/h.4/input_layernorm/ReduceMean",
          "/h.4/input_layernorm/Sub",
          "/h.4/input_layernorm/ReduceMean_1",
          "/h.4/input_layernorm/Pow",
          "/h.4/input_layernorm/Add",
          "/h.4/input_layernorm/Sqrt",
          "/h.4/input_layernorm/Add_1",
          "/h.5/input_layernorm/ReduceMean",
          "/h.5/input_layernorm/Sub",
          "/h.5/input_layernorm/ReduceMean_1",
          "/h.5/input_layernorm/Pow",
          "/h.5/input_layernorm/Add",
          "/h.5/input_layernorm/Sqrt",
          "/h.5/input_layernorm/Add_1",
          "/h.6/input_layernorm/ReduceMean",
          "/h.6/input_layernorm/Sub",
          "/h.6/input_layernorm/ReduceMean_1",
          "/h.6/input_layernorm/Pow",
          "/h.6/input_layernorm/Add",
          "/h.6/input_layernorm/Sqrt",
          "/h.6/input_layernorm/Add_1",
          "/h.7/input_layernorm/ReduceMean",
          "/h.7/input_layernorm/Sub",
          "/h.7/input_layernorm/ReduceMean_1",
          "/h.7/input_layernorm/Pow",
          "/h.7/input_layernorm/Add",
          "/h.7/input_layernorm/Sqrt",
          "/h.7/input_layernorm/Add_1",
          "/h.8/input_layernorm/ReduceMean",
          "/h.8/input_layernorm/Sub",
          "/h.8/input_layernorm/ReduceMean_1",
          "/h.8/input_layernorm/Pow",
          "/h.8/input_layernorm/Add",
          "/h.8/input_layernorm/Sqrt",
          "/h.8/input_layernorm/Add_1",
          "/h.9/input_layernorm/ReduceMean",
          "/h.9/input_layernorm/Sub",
          "/h.9/input_layernorm/ReduceMean_1",
          "/h.9/input_layernorm/Pow",
          "/h.9/input_layernorm/Add",
          "/h.9/input_layernorm/Sqrt",
          "/h.9/input_layernorm/Add_1",
          "/h.10/input_layernorm/ReduceMean",
          "/h.10/input_layernorm/Sub",
          "/h.10/input_layernorm/ReduceMean_1",
          "/h.10/input_layernorm/Pow",
          "/h.10/input_layernorm/Add",
          "/h.10/input_layernorm/Sqrt",
          "/h.10/input_layernorm/Add_1",
          "/h.11/input_layernorm/ReduceMean",
          "/h.11/input_layernorm/Sub",
          "/h.11/input_layernorm/ReduceMean_1",
          "/h.11/input_layernorm/Pow",
          "/h.11/input_layernorm/Add",
          "/h.11/input_layernorm/Sqrt",
          "/h.11/input_layernorm/Add_1",
          "/h.12/input_layernorm/ReduceMean",
          "/h.12/input_layernorm/Sub",
          "/h.12/input_layernorm/ReduceMean_1",
          "/h.12/input_layernorm/Pow",
          "/h.12/input_layernorm/Add",
          "/h.12/input_layernorm/Sqrt",
          "/h.12/input_layernorm/Add_1",
          "/h.13/input_layernorm/ReduceMean",
          "/h.13/input_layernorm/Sub",
          "/h.13/input_layernorm/ReduceMean_1",
          "/h.13/input_layernorm/Pow",
          "/h.13/input_layernorm/Add",
          "/h.13/input_layernorm/Sqrt",
          "/h.13/input_layernorm/Add_1",
          "/h.14/input_layernorm/ReduceMean",
          "/h.14/input_layernorm/Sub",
          "/h.14/input_layernorm/ReduceMean_1",
          "/h.14/input_layernorm/Pow",
          "/h.14/input_layernorm/Add",
          "/h.14/input_layernorm/Sqrt",
          "/h.14/input_layernorm/Add_1",
          "/h.15/input_layernorm/ReduceMean",
          "/h.15/input_layernorm/Sub",
          "/h.15/input_layernorm/ReduceMean_1",
          "/h.15/input_layernorm/Pow",
          "/h.15/input_layernorm/Add",
          "/h.15/input_layernorm/Sqrt",
          "/h.15/input_layernorm/Add_1",
          "/h.16/input_layernorm/ReduceMean",
          "/h.16/input_layernorm/Sub",
          "/h.16/input_layernorm/ReduceMean_1",
          "/h.16/input_layernorm/Pow",
          "/h.16/input_layernorm/Add",
          "/h.16/input_layernorm/Sqrt",
          "/h.16/input_layernorm/Add_1",
          "/h.17/input_layernorm/ReduceMean",
          "/h.17/input_layernorm/Sub",
          "/h.17/input_layernorm/ReduceMean_1",
          "/h.17/input_layernorm/Pow",
          "/h.17/input_layernorm/Add",
          "/h.17/input_layernorm/Sqrt",
          "/h.17/input_layernorm/Add_1",
          "/h.18/input_layernorm/ReduceMean",
          "/h.18/input_layernorm/Sub",
          "/h.18/input_layernorm/ReduceMean_1",
          "/h.18/input_layernorm/Pow",
          "/h.18/input_layernorm/Add",
          "/h.18/input_layernorm/Sqrt",
          "/h.18/input_layernorm/Add_1",
          "/h.19/input_layernorm/ReduceMean",
          "/h.19/input_layernorm/Sub",
          "/h.19/input_layernorm/ReduceMean_1",
          "/h.19/input_layernorm/Pow",
          "/h.19/input_layernorm/Add",
          "/h.19/input_layernorm/Sqrt",
          "/h.19/input_layernorm/Add_1",
          "/h.20/input_layernorm/ReduceMean",
          "/h.20/input_layernorm/Sub",
          "/h.20/input_layernorm/ReduceMean_1",
          "/h.20/input_layernorm/Pow",
          "/h.20/input_layernorm/Add",
          "/h.20/input_layernorm/Sqrt",
          "/h.20/input_layernorm/Add_1",
          "/h.21/input_layernorm/ReduceMean",
          "/h.21/input_layernorm/Sub",
          "/h.21/input_layernorm/ReduceMean_1",
          "/h.21/input_layernorm/Pow",
          "/h.21/input_layernorm/Add",
          "/h.21/input_layernorm/Sqrt",
          "/h.21/input_layernorm/Add_1",
          "/h.22/input_layernorm/ReduceMean",
          "/h.22/input_layernorm/Sub",
          "/h.22/input_layernorm/ReduceMean_1",
          "/h.22/input_layernorm/Pow",
          "/h.22/input_layernorm/Add",
          "/h.22/input_layernorm/Sqrt",
          "/h.22/input_layernorm/Add_1",
          "/h.23/input_layernorm/ReduceMean",
          "/h.23/input_layernorm/Sub",
          "/h.23/input_layernorm/ReduceMean_1",
          "/h.23/input_layernorm/Pow",
          "/h.23/input_layernorm/Add",
          "/h.23/input_layernorm/Sqrt",
          "/h.23/input_layernorm/Add_1",
          "/h.24/input_layernorm/ReduceMean",
          "/h.24/input_layernorm/Sub",
          "/h.24/input_layernorm/ReduceMean_1",
          "/h.24/input_layernorm/Pow",
          "/h.24/input_layernorm/Add",
          "/h.24/input_layernorm/Sqrt",
          "/h.24/input_layernorm/Add_1",
          "/h.25/input_layernorm/ReduceMean",
          "/h.25/input_layernorm/Sub",
          "/h.25/input_layernorm/ReduceMean_1",
          "/h.25/input_layernorm/Pow",
          "/h.25/input_layernorm/Add",
          "/h.25/input_layernorm/Sqrt",
          "/h.25/input_layernorm/Add_1",
          "/h.26/input_layernorm/ReduceMean",
          "/h.26/input_layernorm/Sub",
          "/h.26/input_layernorm/ReduceMean_1",
          "/h.26/input_layernorm/Pow",
          "/h.26/input_layernorm/Add",
          "/h.26/input_layernorm/Sqrt",
          "/h.26/input_layernorm/Add_1",
          "/h.27/input_layernorm/ReduceMean",
          "/h.27/input_layernorm/Sub",
          "/h.27/input_layernorm/ReduceMean_1",
          "/h.27/input_layernorm/Pow",
          "/h.27/input_layernorm/Add",
          "/h.27/input_layernorm/Sqrt",
          "/h.27/input_layernorm/Add_1",
          "/h.28/input_layernorm/ReduceMean",
          "/h.28/input_layernorm/Sub",
          "/h.28/input_layernorm/ReduceMean_1",
          "/h.28/input_layernorm/Pow",
          "/h.28/input_layernorm/Add",
          "/h.28/input_layernorm/Sqrt",
          "/h.28/input_layernorm/Add_1",
          "/h.29/input_layernorm/ReduceMean",
          "/h.29/input_layernorm/Sub",
          "/h.29/input_layernorm/ReduceMean_1",
          "/h.29/input_layernorm/Pow",
          "/h.29/input_layernorm/Add",
          "/h.29/input_layernorm/Sqrt",
          "/h.29/input_layernorm/Add_1",
          "/h.30/input_layernorm/ReduceMean",
          "/h.30/input_layernorm/Sub",
          "/h.30/input_layernorm/ReduceMean_1",
          "/h.30/input_layernorm/Pow",
          "/h.30/input_layernorm/Add",
          "/h.30/input_layernorm/Sqrt",
          "/h.30/input_layernorm/Add_1",
          "/h.31/input_layernorm/ReduceMean",
          "/h.31/input_layernorm/Sub",
          "/h.31/input_layernorm/ReduceMean_1",
          "/h.31/input_layernorm/Pow",
          "/h.31/input_layernorm/Add",
          "/h.31/input_layernorm/Sqrt",
          "/h.31/input_layernorm/Add_1",
          "/ln_f/ReduceMean",
          "/ln_f/Sub",
          "/ln_f/Pow",
          "/ln_f/Add",
          "/ln_f/Sqrt"
        ]
      }
    },
    "perf_tuning": {
      "type": "OrtPerfTuning",
      "config": {
        "user_script": "user_script.py",
        "dataloader_func": "create_dataloader",
        "device": "gpu",
        "batch_size": 1,
        "execution_mode_list": [ "ORT_SEQUENTIAL" ],
        "providers_list": [ "DmlExecutionProvider" ]
      }
    }
  },
  "engine": {
    "log_severity_level": 0,
    "search_strategy": {
      "execution_order": "joint",
      "search_algorithm": "exhaustive"
    },
    "evaluator": "common_evaluator",
    "evaluate_input_model": false,
    "host": "local_system",
    "target": "local_system",
    "clean_cache": true,
    "cache_dir": "cache"
  }
}
